<html><body><pre style="word-wrap: break-word; white-space: pre-wrap;">#include &lt;cstdio&gt;
#include &lt;algorithm&gt;
#include &lt;vector&gt;

using namespace std;

typedef unsigned long long hash;

hash p=22801763489LL;

hash parseInput()
{
    vector&lt;hash&gt; subTree;
    while(getchar()=='(') subTree.push_back(parseInput());
    sort(subTree.begin(),subTree.end());
    hash h=3;
    for(int i=0,e=subTree.size();i&lt;e;++i)
	h=(h*p)^subTree[i];
    //printf("%llu\n",h*7);
    return h*7;
}

int main()
{
    int z; scanf("%d",&amp;z);
    while(z--)
    {
	int n; scanf("%d\n",&amp;n);
	hash tree[n];
	for(int i=0;i&lt;n;++i)
	{
	    if(getchar()=='(') { tree[i]=parseInput(); if(i&lt;n-1) scanf("\n"); }
	    else tree[i]=0;
	}
	sort(tree,tree+n);
	printf("%ld\n",unique(tree,tree+n)-tree);
    }
    return 0;
}
</pre></body></html>